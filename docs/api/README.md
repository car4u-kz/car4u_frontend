# API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –û–±–∑–æ—Ä

API –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ Next.js App Router —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º API Routes. –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–∫—Å–∏—Ä—É—é—Ç—Å—è –∫ .NET –±–µ–∫–µ–Ω–¥—É —á–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Å–ª–æ–π.

## –ë–∞–∑–æ–≤—ã–π URL

- **Development:** `http://localhost:3000/api`
- **Production:** `https://your-domain.vercel.app/api`

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ç—Ä–µ–±—É—é—Ç JWT —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ:

```
Authorization: Bearer <jwt_token>
```

–î–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:

```
X-Organization-Id: <organization_id>
```

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

#### `POST /api/auth/validate`

–í–∞–ª–∏–¥–∞—Ü–∏—è Clerk —Ç–æ–∫–µ–Ω–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**

- `Authorization: Bearer <clerk_token>`

**–û—Ç–≤–µ—Ç:**

```json
{
  "id": "user_id",
  "role": "admin|user",
  "status": "active|unconfirmed|access_denied|deleted",
  "token": "backend_jwt_token"
}
```

---

### üè¢ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

#### `GET /api/organization/my`

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**

- `Authorization: Bearer <jwt_token>`

**–û—Ç–≤–µ—Ç:**

```json
[
  {
    "id": "org_id",
    "name": "Organization Name",
    "accounts": [
      {
        "id": "account_id",
        "name": "Account Name",
        "platform": "kolesa"
      }
    ]
  }
]
```

#### `GET /api/organization/all`

–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤).

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**

- `Authorization: Bearer <jwt_token>`

---

### üîç –ü–æ–∏—Å–∫–∏

#### `GET /api/search`

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–∏—Å–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**

- `Authorization: Bearer <jwt_token>`
- `X-Organization-Id: <org_id>`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**

- `page` (number) - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `limit` (number) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

**–û—Ç–≤–µ—Ç:**

```json
{
  "data": [
    {
      "id": "search_id",
      "name": "BMW X5 2020+",
      "filters": {
        "brand": "BMW",
        "model": "X5",
        "yearFrom": 2020
      },
      "createdAt": "2024-01-01T00:00:00Z",
      "isActive": true
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 100,
    "totalPages": 5
  }
}
```

#### `POST /api/search`

–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞.

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**

- `Authorization: Bearer <jwt_token>`
- `X-Organization-Id: <org_id>`

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**

```json
{
  "name": "BMW X5 2020+",
  "filters": {
    "brand": "BMW",
    "model": "X5",
    "yearFrom": 2020,
    "priceTo": 50000000,
    "region": "almaty"
  }
}
```

#### `PUT /api/search/:id`

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞.

#### `DELETE /api/search/:id`

–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞.

---

### üìã –û–±—ä—è–≤–ª–µ–Ω–∏—è

#### `GET /api/ads`

–ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ –ø–æ–∏—Å–∫–∞–º.

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**

- `Authorization: Bearer <jwt_token>`
- `X-Organization-Id: <org_id>`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**

- `searchId` (string) - ID –ø–æ–∏—Å–∫–∞
- `page` (number) - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `limit` (number) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- `sortBy` (string) - –ø–æ–ª–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- `sortOrder` (string) - –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (asc/desc)

**–û—Ç–≤–µ—Ç:**

```json
{
  "data": [
    {
      "id": "ad_id",
      "title": "BMW X5 2021",
      "brand": "BMW",
      "model": "X5",
      "year": 2021,
      "price": 25000000,
      "mileage": 50000,
      "engine": "3.0",
      "transmission": "–ê–≤—Ç–æ–º–∞—Ç",
      "bodyType": "–í–Ω–µ–¥–æ—Ä–æ–∂–Ω–∏–∫",
      "region": "–ê–ª–º–∞—Ç—ã",
      "url": "https://kolesa.kz/...",
      "foundAt": "2024-01-01T00:00:00Z",
      "searchId": "search_id"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 150,
    "totalPages": 8
  }
}
```

#### `GET /api/ads/filters`

–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π.

**–û—Ç–≤–µ—Ç:**

```json
{
  "brands": ["BMW", "Mercedes", "Audi"],
  "models": {
    "BMW": ["X5", "X3", "3 Series"],
    "Mercedes": ["GLE", "GLC", "C-Class"]
  },
  "regions": ["–ê–ª–º–∞—Ç—ã", "–ê—Å—Ç–∞–Ω–∞", "–®—ã–º–∫–µ–Ω—Ç"],
  "bodyTypes": ["–°–µ–¥–∞–Ω", "–í–Ω–µ–¥–æ—Ä–æ–∂–Ω–∏–∫", "–•—ç—Ç—á–±–µ–∫"],
  "transmissions": ["–ê–≤—Ç–æ–º–∞—Ç", "–ú–µ—Ö–∞–Ω–∏–∫–∞", "–í–∞—Ä–∏–∞—Ç–æ—Ä"]
}
```

---

### üìä –ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è

#### `GET /api/my-ads`

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**

- `Authorization: Bearer <jwt_token>`
- `X-Organization-Id: <org_id>`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**

- `accountId` (string) - ID –∞–∫–∫–∞—É–Ω—Ç–∞
- `page` (number) - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `limit` (number) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤

**–û—Ç–≤–µ—Ç:**

```json
{
  "data": [
    {
      "id": "my_ad_id",
      "title": "BMW X5 2021",
      "url": "https://kolesa.kz/...",
      "accountId": "account_id",
      "currentPosition": 5,
      "views": 150,
      "price": 25000000,
      "status": "active",
      "lastChecked": "2024-01-01T00:00:00Z",
      "history": [
        {
          "date": "2024-01-01T00:00:00Z",
          "position": 5,
          "views": 150,
          "price": 25000000
        }
      ]
    }
  ]
}
```

#### `POST /api/my-ads`

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**

- `Authorization: Bearer <jwt_token>`
- `X-Organization-Id: <org_id>`

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**

```json
{
  "url": "https://kolesa.kz/cars/bmw-x5-2021/123456",
  "accountId": "account_id"
}
```

#### `PUT /api/my-ads/:id/change-state`

–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**

```json
{
  "isActive": true
}
```

#### `DELETE /api/my-ads/:id`

–£–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∏–∑ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

---

### üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

#### `GET /api/ads/report`

–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –ø–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**

- `searchId` (string) - ID –ø–æ–∏—Å–∫–∞
- `dateFrom` (string) - –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ (ISO)
- `dateTo` (string) - –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è (ISO)
- `groupBy` (string) - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ (day/week/month)

**–û—Ç–≤–µ—Ç:**

```json
{
  "data": [
    {
      "date": "2024-01-01",
      "totalAds": 25,
      "newAds": 5,
      "avgPrice": 22000000,
      "minPrice": 18000000,
      "maxPrice": 30000000
    }
  ]
}
```

#### `GET /api/ads/viewed`

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤.

#### `POST /api/ads/viewed`

–û—Ç–º–µ—Ç–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–≥–æ.

---

### üîß –ü–∞—Ä—Å–∏–Ω–≥

#### `GET /api/parsing-template`

–ü–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞.

#### `POST /api/parsing-template`

–°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞.

#### `PUT /api/parsing-template/:id/change-state`

–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —à–∞–±–ª–æ–Ω–∞.

#### `GET /api/parsing-template/lookup`

–ü–æ–∏—Å–∫ —à–∞–±–ª–æ–Ω–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞.

---

## –ö–æ–¥—ã –æ—à–∏–±–æ–∫

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ                   |
| --- | -------------------------- |
| 200 | –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å            |
| 400 | –ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ |
| 401 | –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω             |
| 403 | –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω            |
| 404 | –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω           |
| 422 | –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏           |
| 500 | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞  |

## –§–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫

```json
{
  "error": "Error message",
  "code": "ERROR_CODE",
  "details": {
    "field": "error description"
  }
}
```

## –ü–∞–≥–∏–Ω–∞—Ü–∏—è

–í—Å–µ —Å–ø–∏—Å–∫–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—é:

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- `page` - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–Ω–∞—á–∏–Ω–∞—è —Å 1)
- `limit` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20, –º–∞–∫—Å–∏–º—É–º 100)

**–û—Ç–≤–µ—Ç:**

```json
{
  "data": [...],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 100,
    "totalPages": 5,
    "hasNext": true,
    "hasPrev": false
  }
}
```

## –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –ø–æ–ª—è–º:

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- `sortBy` - –ø–æ–ª–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- `sortOrder` - –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (`asc` –∏–ª–∏ `desc`)

**–ü—Ä–∏–º–µ—Ä:**

```
GET /api/ads?sortBy=price&sortOrder=desc
```
